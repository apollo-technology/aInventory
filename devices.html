<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" type="text/css" href="w3.css">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="parse.js"></script>
    <title>Devices</title>
</head>

<body>
    <div class="loadingView">
        <center>
            <p>Loading...</p>
            <img src="loading.gif" style="width:15%">
        </center>
    </div>
    <div class="deviceDetail">
        <center>
            <h2 style="color:black;">Devices</h2>
            <table class="w3-table-all" style="width:100%;color:black;">
                <tbody>
                </tbody>
            </table>
        </center>
    </div>
    <center>
            <div class="leftCard">
                <button id="loadButton" class="hoverButtonDark" onclick="cancel()">Home</button>
            </div>
            <div class="rightCard">
                <button id="loadButton" class="hoverButtonDark" onclick="swappaSeller()">New</button>
            </div>
        </center>
</body>
<script type="text/javascript">

function swappaSeller () {
    window.open("device.html","_self");
}

Parse.initialize("qXdzVklC8KWpQ537qN3U9FZr7eLrFpYd0xepZ2bm", "x6NLNRS3G7sg6g74R1QPJ5aycu7mNJ1jthjx45nn");
Parse.serverURL = 'https://parseapi.back4app.com';

function addRow(id, device, quality, color) {
    if (!document.getElementsByTagName) return;
    tabBody = document.getElementsByTagName("tbody").item(0);

    var btn = document.createElement('input');
    btn.type = "button";
    btn.className = "btn";
    btn.value = "View";
    btn.onclick = function() {
        openDevice(id);
    };


    row = document.createElement("tr")
    cell1 = document.createElement("td");
    cell2 = document.createElement("td");
    cell3 = document.createElement("td");
    cell4 = document.createElement("td");
    textnode1 = document.createTextNode("id: " + id);
    textnode2 = document.createTextNode(device);
    textnode3 = document.createTextNode(color);
    textnode4 = document.createTextNode(quality);
    cell1.appendChild(btn);
    cell1.appendChild(textnode1);
    cell2.appendChild(textnode2);
    cell3.appendChild(textnode3);
    cell4.appendChild(textnode4);
    row.appendChild(cell1);
    row.appendChild(cell2);
    row.appendChild(cell3);
    row.appendChild(cell4);
    tabBody.appendChild(row);
}

function openDevice(id) {
    // body...
    window.open("device.html?id=" + id, "_self");

}
function cancel() {
    // body...
    window.open("index.html", "_self");

}
function startSearch() {
    // body...
    var teamClass = Parse.Object.extend("devices");
    var query = new Parse.Query(teamClass);
    query.ascending("atId");
    query.find({
        success: function(results) {
            if (results.length == 0) {
                console.log("Did not find a class");
                window.open("index.html", "_self");
                alert("Well, looks like there are no devices in inventory!");
            } else {
                // Do something with the returned Parse.Object values
                for (var i = 0; i < results.length; i++) {
                    var object = results[i];
                    var id = object.get("atId");
                    var model = object.get("model");
                    var color = object.get("color");
                    var quality = object.get("condition");
                    addRow(id, model, color, quality);

                    $('.loadingView').hide()
                    $(".deviceDetail").show();
                }
            }
        },
        error: function(error) {
            alert("Error: " + error.code + " " + error.message);
        }
    });
}
$('.deviceDetail').hide()
$(".loadingView").show();
startSearch();
</script>

</html>
