<!DOCTYPE html>
<html>

<head>
    <title>Part</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="parse.js"></script>
</head>

<body>
    <center>
        <div class="leftCard">
            <button id="loadButton" class="hoverButtonDark" onclick="cancel()">Parts</button>
        </div>
    </center>
    <div class="loadingView">
        <center>
            <p>Loading...</p>
            <img src="loading.gif" style="width:15%">
        </center>
    </div>
    <div class="deviceDetail">
        <p class="deviceTitle" id="partTitle" style="text-align:center">Part</p>
        <p class="inputFieldText">Part ID</p>
        <input type="text" class="inputField" placeholder="Device ID" id="idField">
        <br>
        <p class="inputFieldText">Model</p>
        <select name="model" id="modelField">
            <option value="iPhone 4">iPhone 4</option>
            <option value="iPhone 4s">iPhone 4S</option>
            <option value="iPhone 5">iPhone 5</option>
            <option value="iPhone 5c">iPhone 5C</option>
            <option value="iPhone 5s">iPhone 5S</option>
            <option value="iPhone SE">iPhone SE</option>
            <option value="iPhone 6">iPhone 6</option>
            <option value="iPhone 6+">iPhone 6 Plus</option>
            <option value="iPhone 6s">iPhone 6S</option>
            <option value="iPhone 6s+">iPhone 6S Plus</option>
        </select>
        <br>
        <p class="inputFieldText">Color</p>
        <select name="model" id="colorField">
            <option value="Light">Light</option>
            <option value="Dark">Dark</option>
        </select>
        <br>
        <p class="inputFieldText">Value</p>
        <input type="text" class="inputField" placeholder="Value" id="valueField">
        <br>
        <p class="inputFieldText">Kind</p>
        <select name="model" id="kindField">
            <option value="OEM Screen">OEM Screen</option>
            <option value="Cracked Screen">Cracked Screen</option>
            <option value="Bad Screen">Bad Screen</option>
            <option value="Home Button">Home Button</option>
            <option value="Battery">Battery</option>
            <option value="Front Camera">Front Camera</option>
            <option value="Back Camera">Back Camera</option>
            <option value="Lock Button">Lock Button</option>
            <option value="Sim Tray">Sim Tray</option>
            <option value="Digitizer & LCD">Digitizer & LCD</option>
            <option value="Logic Board">iPhone 6S Plus</option>
            <option value="Ear Piece">Ear Piece</option>
        </select>
        <br>
        <p class="inputFieldText">Notes</p>
        <textarea type="text" class="inputField" placeholder="Notes" id="notesField" style="height:100px;"></textarea>
        <br>
        <br>
        <center>
            <div class="leftCard">
                <button id="loadButton" class="hoverButtonLight" onclick="deleteObject()">Delete</button>
            </div>
            <div class="rightCard">
                <button id="loadButton" class="hoverButtonLight" onclick="update()">Update</button>
            </div>
        </center>
    </div>
</body>
<script type="text/javascript">
Parse.initialize("qXdzVklC8KWpQ537qN3U9FZr7eLrFpYd0xepZ2bm", "x6NLNRS3G7sg6g74R1QPJ5aycu7mNJ1jthjx45nn");
Parse.serverURL = 'https://parseapi.back4app.com';
var deviceId = getURIParameter("id");

var deviceParseId;

$('.deviceDetail').hide()
$(".loadingView").show();

function getURIParameter(param, asArray) {
    return document.location.search.substring(1).split('&').reduce(function(p, c) {
        var parts = c.split('=', 2).map(function(param) {
            return decodeURIComponent(param);
        });
        if (parts.length == 0 || parts[0] != param) return (p instanceof Array) && !asArray ? null : p;
        return asArray ? p.concat(parts.concat(true)[1]) : parts.concat(true)[1];
    }, []);
}
if (deviceId) {
    var devices = Parse.Object.extend("parts");
    var query = new Parse.Query(devices);
    query.equalTo("atpId", deviceId);
    query.find({
        success: function(results) {
            if (results.length < 1) {
                alert("Part does not exist.");
                //window.open("index.html", "_self");
            } else {
                var device = results[0];
                deviceParseId = device.id;
                var notes = device.get("notes");
                var color = device.get("color");
                var model = device.get("model");
                var atpId = device.get("atpId");
                var value = device.get("purchasePrice");
                var kind = device.get("kind");

                document.getElementById("notesField").value = notes;
                document.getElementById("colorField").value = color;
                document.getElementById("modelField").value = model;
                document.getElementById("idField").value = atpId;
                document.getElementById("valueField").value = value;
                document.getElementById("partTitle").innerHTML = model + " " + kind;
                document.getElementById("kindField").value = kind;

                $('.deviceDetail').show()
                $(".loadingView").hide();
            }
        },
        error: function(error) {
            alert("Error: " + error.code + " " + error.message);
        }
    });
} else {
    console.log("weofijewfoij")
    $('.deviceDetail').show()
    $(".loadingView").hide();
}

function cancel() {
    window.open("parts.html", "_self");
}

function deleteObject() {
    $('.deviceDetail').hide();
    $(".loadingView").show();
    device.destroy({
        success: function(device) {
            // The object was deleted from the Parse Cloud.
            cancel();
        },
        error: function(device, error) {
            // The delete failed.
            // error is a Parse.Error with an error code and message.
            alert("Error: " + error.code + " " + error.message);
        }
    });
}

function update() {
    $('.deviceDetail').hide()
    $(".loadingView").show();
    // Create a pointer to an object of class Point with id dlkj83d
    var DeviceClass = Parse.Object.extend("parts");
    var device = new DeviceClass();
    if (deviceId) {
        device.id = deviceParseId;
    }

    // Set a new value on quantity

    console.log(document.getElementById("valueField").value);
    device.set("notes", document.getElementById("notesField").value);
    device.set("color", document.getElementById("colorField").value);
    device.set("model", document.getElementById("modelField").value);
    device.set("atpId", document.getElementById("idField").value);
    device.set("kind", document.getElementById("kindField").value);
    device.set("purchasePrice", document.getElementById("valueField").value);

    // Save
    device.save(null, {
        success: function(device) {
            // Saved successfully.
            window.open("parts.html", "_self");
        },
        error: function(device, error) {
            // The save failed.
            // error is a Parse.Error with an error code and description.
        }
    });
}
</script>

</html>
