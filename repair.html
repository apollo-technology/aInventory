<!DOCTYPE html>
<html>

<head>
    <title>Repair</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="parse.js"></script>
</head>

<body>
    <center>
        <div class="leftCard">
            <button id="loadButton" class="hoverButtonDark" onclick="cancel()">Repairs</button>
        </div>
    </center>
    <div class="loadingView">
        <center>
            <p>Loading...</p>
            <img src="loading.gif" style="width:15%">
        </center>
    </div>
    <div class="deviceDetail">
        <p class="deviceTitle" id="clientField" style="text-align:center">Client</p>
        <p class="inputFieldText">Name</p>
        <input type="text" class="inputField" placeholder="Name" id="nameField">
        <br>
        <p class="inputFieldText">Phone</p>
        <input type="text" class="inputField" placeholder="Phone" id="phoneField">
        <br>
        <p class="inputFieldText">Model</p>
        <input type="text" class="inputField" placeholder="Model" id="modelField">
        <br>
        <p class="inputFieldText">Kind</p>
        <input type="text" class="inputField" placeholder="Kind" id="kindField">
        <br>
        <p class="inputFieldText">Color</p>
        <input type="text" class="inputField" placeholder="Color" id="colorField">
        <br>
        <p class="inputFieldText">Date</p>
        <input type="text" class="inputField" placeholder="Date" id="dateField">
        <br>
        <p class="inputFieldText">Technician</p>
        <input type="text" class="inputField" placeholder="Technician" id="didRepairField">
        <br>
        <p class="inputFieldText">Is Completed</p>
        <input type="text" class="inputField" placeholder="Is Completed" id="isCompletedField">
        <br>
        <p class="inputFieldText">Final Bill</p>
        <input type="text" class="inputField" placeholder="Final Bill" id="finalBillField">
        <br>
        <p class="inputFieldText">Notes</p>
        <input type="text" class="inputField" placeholder="Notes" id="notesField" style="height:100px;">
        <br>
        <br>
        <center>
            <button id="loadButton" class="hoverButtonLight" onclick="update()">Update</button>
        </center>
    </div>
</body>
<script type="text/javascript">
Parse.initialize("qXdzVklC8KWpQ537qN3U9FZr7eLrFpYd0xepZ2bm", "x6NLNRS3G7sg6g74R1QPJ5aycu7mNJ1jthjx45nn");
Parse.serverURL = 'https://parseapi.back4app.com';
var deviceId = getURIParameter("id");

var repairObject;

var deviceParseId;

function getURIParameter(param, asArray) {
    return document.location.search.substring(1).split('&').reduce(function(p, c) {
        var parts = c.split('=', 2).map(function(param) {
            return decodeURIComponent(param);
        });
        if (parts.length == 0 || parts[0] != param) return (p instanceof Array) && !asArray ? null : p;
        return asArray ? p.concat(parts.concat(true)[1]) : parts.concat(true)[1];
    }, []);
}

var GameScore = Parse.Object.extend("repairs");
var query = new Parse.Query(GameScore);
query.get(deviceId, {
    success: function(device) {
        // The object was retrieved successfully.
        deviceParseId = device.id;
        repairObject = device;
        var notes = device.get("notes");
        var color = device.get("color");
        var model = device.get("model");
        var finalBill = device.get("finalBill");
        var kind = device.get("kind");
        var completed = device.get("isCompleted");
        var date = device.get("date");
        var phone = device.get("clientPhone");
        var name = device.get("clientName");
        var didRepair = device.get("technician");

        document.getElementById("notesField").value = notes;
        document.getElementById("colorField").value = color;
        document.getElementById("modelField").value = model;
        document.getElementById("nameField").value = name;
        document.getElementById("finalBillField").value = finalBill;
        document.getElementById("isCompletedField").value = completed;
        document.getElementById("clientField").innerHTML = model + " " + kind + " for " + name;
        document.getElementById("kindField").value = kind;
        document.getElementById("didRepairField").value = didRepair;
        document.getElementById("phoneField").value = phone;
        document.getElementById("dateField").value = date;

        $('.deviceDetail').show()
        $(".loadingView").hide();
    },
    error: function(object, error) {
        // The object was not retrieved successfully.
        // error is a Parse.Error with an error code and message.
        alert("Error: " + error.code + " " + error.message);
    }
});

function cancel() {
    window.open("repairs.html", "_self");
}

function update() {
    $('.deviceDetail').hide()
    $(".loadingView").show();

    repairObject.set("notes", document.getElementById("notesField").value);
    repairObject.set("color", document.getElementById("colorField").value);
    repairObject.set("model", document.getElementById("modelField").value);
    repairObject.set("clientName", document.getElementById("nameField").value);
    repairObject.set("finalBill", document.getElementById("finalBillField").value);
    if (document.getElementById("isCompletedField").value == "true") {
        repairObject.set("isCompleted", true);
    } else {
        repairObject.set("isCompleted", false);
    }
    repairObject.set("kind", document.getElementById("kindField").value);
    repairObject.set("technician", document.getElementById("didRepairField").value);
    repairObject.set("clientPhone", document.getElementById("phoneField").value);
    repairObject.set("date", document.getElementById("dateField").value);

    repairObject.save(null, {
        success: function(repairObject) {
            window.open("repairs.html", "_self");
        }
    });
}
$('.deviceDetail').hide()
$(".loadingView").show();
</script>

</html>
